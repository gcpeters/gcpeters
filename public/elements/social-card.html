<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="/components/core-icon-button/core-icon-button.html">

<polymer-element name="social-card" attributes="tweet">
	<template>
		<style>
			:host {
				display: block;
				position: relative;
				background-color: white;
				padding: 1em 0;
				width: 100%;
				font-size: 1.2rem;
				font-weight: 300;
			}

			.card-header {
				margin-bottom: 10px;
				padding: 0 1em;
			}

			.card-header h2 {
				font-size: 1.8rem;
				font-weight: 300;
				margin: 0;
			}

			.card-header img {
				border-radius: 50%;
				border: solid 3px #039be5;
				margin: 10px;
				width: 70px;
				height: 70px;
			}

			p {
				padding: 0 1em;
			}

			a, a:link, a:visited {
				color: #0277bd;
				text-decoration: none;
			}

			a:hover {
				color: #4fc3f7;
			}

			a:active {
				color: #039be5;
			}

			core-icon-button {
				position: absolute;
				top: 3px;
				right: 3px;
				fill: #636363;
			}

			:host([favorite]) core-icon-button {
				fill: #da4336;
			}
		</style>

		<div class="card-header" layout horizontal center>
			<img src="{{tweet.user.profile_image_url}}" width="70" height="70">
			<h2>
				{{tweet.user.name}}<br />
				<a href="https://twitter.com/{{tweet.user.screen_name}}" target="_blank">@{{tweet.user.screen_name}}</a>
			</h2>
		</div>

		<div id="media"></div>

		<p id="body"></p>
		<p><em><sub id="createdAt"></sub></em></p>

		<core-icon-button
			id="favicon"
			icon="favorite"
			on-tap="{{favoriteTapped}}">
		</core-icon-button>

		<content></content>
	</template>

	<script>
		window.Polymer('social-card', {
			publish: {
				favorite: {
					value: false,
					reflect: true
				}
			},

			ready: function () {
				var tweet = this.tweet,
					urlRE = /\b((https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?)\b/g,
					media,
					image;

				this.$.createdAt.innerHTML = moment(new Date(tweet.created_at)).format("MMM Do YY");
				this.$.body.innerHTML = tweet.text.replace(urlRE, '<a href="$1" target="_blank">$1</a>');

				if (!tweet.entities) {

					return;
				}

				media = tweet.entities.media;

				if (!media) {

					return;
				}

				image = document.createElement('img');
				image.src = media[0].media_url;
				image.style.width = '100%';
				this.$.media.appendChild(image);
			},

			favoriteTapped: function (evt, detail, sender) {
				this.favorite = !this.favorite;
				this.fire('favorite-tap');
			}
		});
	</script>
</polymer-element>
